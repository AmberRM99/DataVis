<head>
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-2.16.1.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
</head>

<body>
	<div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
</body>

<script>    
    d3.csv('/malaria.csv', function(err, rows){

    function filter_and_unpack(rows, key, year) {
    return rows.filter(row => row['certified'] <= year).map(row => row[key])
    }
  
    var frames = []
    var slider_steps = []
  
    var n = 12;
    var num = 2009;
    for (var i = 0; i <= n; i++) {
      var z = filter_and_unpack(rows, 'certified', num)
      var locations = filter_and_unpack(rows, 'Alpha-3 code', num)
      frames[i] = {data: [{z: z, locations: locations, text: locations}], name: num}
      slider_steps.push ({
          label: num.toString(),
          method: "animate",
          args: [[num], {
              mode: "immediate",
              transition: {duration: 300},
              frame: {duration: 300}
            }
          ]
        })
      num = num + 1
    }
  
  var data = [{
        type: 'choropleth',
        locationmode: 'ISO-3',
        locations: frames[0].data[0].locations,
        z: frames[0].data[0].z,
        text: frames[0].data[0].locations,
        colorscale:[[0,"#10564B"],
      [1, "#BAE9E4"]], 
        zauto: false,
        // zmin: 1963,30
        zmax: 2021
  
  }];
  var layout = {
    title: 'where and when has malaria been eradicated',
    geo: {
        showland: true,
        landcolor:"black",  
        bgcolor:"rgba(0,0,0,0)",
        lakecolor:"rgba(0,0,0,0)",
        oceancolor:"rgba(0,0,0,0)",
        // projection: {
        //     type: 'robinson'
        // }
    },
    font_color:"white",
    paper_bgcolor:"rgba(0,0,0,0)",
    height:600,
    width:1000,
      updatemenus: [{
        x: 0.1,
        y: 0,
        yanchor: "top",
        xanchor: "right",
        showactive: false,
        direction: "left",
        type: "buttons",
        pad: {"t": 87, "r": 10},
        buttons: [{
          method: "animate",
          args: [null, {
            fromcurrent: true,
            transition: {
              duration: 200,
            },
            frame: {
              duration: 500
            }
          }],
          label: "Play"
        }, {
          method: "animate",
          args: [   
            [null],
            {
              mode: "immediate",
              transition: {
                duration: 0
              },
              frame: {
                duration: 0
              }
            }
          ],
          label: "Pause"
        }]
      }],
      sliders: [{
        active: 0,
        steps: slider_steps,
        x: 0.1,
        len: 0.9,
        xanchor: "left",
        y: 0,
        yanchor: "top",
        pad: {t: 50, b: 10},
        currentvalue: {
          visible: true,
          prefix: "Year:",
          xanchor: "right",
          font: {
            size: 20,
            color: "#666"
          }
        },
        transition: {
          duration: 300,
          easing: "cubic-in-out"
        }
      }]
  };
  
  Plotly.newPlot('myDiv', data, layout).then(function() {
      Plotly.addFrames('myDiv', frames);
    });
  })
  
  </script>